<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë°˜ì‘ì†ë„ í…ŒìŠ¤íŠ¸</title>
  <style>
    body{
      font-family: system-ui, sans-serif;
      display:flex; flex-direction:column; align-items:center; gap:14px;
      padding:30px; background:#0f172a; color:#e2e8f0;
    }
    #box{
      width:320px; height:220px; border-radius:16px;
      display:flex; align-items:center; justify-content:center;
      font-size:20px; font-weight:700; text-align:center;
      background:#334155; cursor:pointer; user-select:none;
      transition: background .2s;
      box-shadow:0 10px 20px rgba(0,0,0,.35);
    }
    #info{ font-size:16px; opacity:.9; }
    #best{ font-size:14px; opacity:.7; }
    button{
      padding:10px 16px; border:none; border-radius:12px;
      background:#22c55e; color:#052e16; font-weight:800; cursor:pointer;
    }
  </style>
</head>
<body>

  <h2>âš¡ ë°˜ì‘ì†ë„ í…ŒìŠ¤íŠ¸</h2>

  <div id="box">ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</div>

  <button id="startBtn">ì‹œì‘</button>
  <div id="info"></div>
  <div id="best"></div>

<script>
(() => {
  const box = document.getElementById("box");
  const startBtn = document.getElementById("startBtn");
  const info = document.getElementById("info");
  const bestEl = document.getElementById("best");

  let state = "idle"; // idle | waiting | go
  let timerId = null;
  let startTime = 0;

  const BEST_KEY = "reaction_best_ms";
  const loadBest = () => Number(localStorage.getItem(BEST_KEY) || 0);
  const saveBest = (ms) => localStorage.setItem(BEST_KEY, String(ms));

  function renderBest(){
    const best = loadBest();
    bestEl.textContent = best ? `ğŸ† ìµœê³ ê¸°ë¡: ${best} ms` : "ğŸ† ìµœê³ ê¸°ë¡ ì—†ìŒ";
  }

  function setBox(bg, text){
    box.style.background = bg;
    box.textContent = text;
  }

  function reset(){
    state = "idle";
    if(timerId) clearTimeout(timerId);
    timerId = null;
    startTime = 0;
    setBox("#334155", "ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”");
    info.textContent = "";
    startBtn.disabled = false;
  }

  function start(){
    state = "waiting";
    startBtn.disabled = true;
    info.textContent = "ì´ˆë¡ìƒ‰ìœ¼ë¡œ ë°”ë€Œë©´ ì¦‰ì‹œ í´ë¦­!";
    setBox("#ef4444", "ëŒ€ê¸°ì¤‘... ì§€ê¸ˆ ëˆ„ë¥´ë©´ ì‹¤íŒ¨!");
    const delay = 1000 + Math.random() * 3000; // 1~4ì´ˆ
    timerId = setTimeout(() => {
      state = "go";
      startTime = performance.now();
      setBox("#22c55e", "ì§€ê¸ˆ í´ë¦­!");
    }, delay);
  }

  box.addEventListener("click", () => {
    if(state === "waiting"){
      // ë„ˆë¬´ ë¹¨ë¦¬ í´ë¦­
      info.textContent = "âŒ ë„ˆë¬´ ë¹¨ë¼ìš”! ë‹¤ì‹œ í•´ë³´ì„¸ìš”.";
      setBox("#f59e0b", "ì„±ê¸‰í•¨ ğŸ˜…\n(ë‹¤ì‹œ ì‹œì‘)");
      state = "idle";
      if(timerId) clearTimeout(timerId);
      timerId = null;
      startBtn.disabled = false;
      return;
    }

    if(state === "go"){
      const ms = Math.round(performance.now() - startTime);
      info.textContent = `âœ… ë°˜ì‘ì†ë„: ${ms} ms`;

      const best = loadBest();
      if(!best || ms < best){
        saveBest(ms);
        info.textContent += "  (ì‹ ê¸°ë¡!) ğŸ‰";
      }

      renderBest();
      setBox("#0ea5e9", "ë‹¤ì‹œ í•˜ë ¤ë©´ ì‹œì‘!");
      state = "idle";
      startBtn.disabled = false;
    }
  });

  startBtn.addEventListener("click", start);

  renderBest();
})();
</script>

</body>
</html>
